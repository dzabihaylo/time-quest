---
phase: 10-ui-brand-refresh
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - TimeQuest/App/DesignSystem/DesignTokens.swift
  - TimeQuest/App/DesignSystem/ViewModifiers/CardModifier.swift
  - TimeQuest/App/DesignSystem/ViewModifiers/ChipModifier.swift
  - TimeQuest/App/DesignSystem/ViewModifiers/ButtonModifiers.swift
  - TimeQuest/App/TimeQuestApp.swift
  - TimeQuest/TimeQuest.xcodeproj/project.pbxproj
autonomous: true

must_haves:
  truths:
    - "A DesignTokens instance is accessible from any view via @Environment(\\.designTokens)"
    - "Dark mode is the default color scheme when the app launches"
    - "tokens.font(.headline, weight: .semibold) returns SF Rounded typography"
    - ".tqCard() modifier applies consistent card styling with dark-mode-aware borders"
    - ".tqChip(color:) modifier applies consistent capsule badge styling"
  artifacts:
    - path: "TimeQuest/App/DesignSystem/DesignTokens.swift"
      provides: "All semantic tokens: colors, typography, spacing, shapes, SpriteKit color helpers"
      contains: "@Entry var designTokens"
    - path: "TimeQuest/App/DesignSystem/ViewModifiers/CardModifier.swift"
      provides: "tqCard() ViewModifier with standard and nested elevation"
      contains: "func tqCard"
    - path: "TimeQuest/App/DesignSystem/ViewModifiers/ChipModifier.swift"
      provides: "tqChip(color:) ViewModifier for capsule badges"
      contains: "func tqChip"
    - path: "TimeQuest/App/DesignSystem/ViewModifiers/ButtonModifiers.swift"
      provides: "tqPrimaryButton() ViewModifier for main CTAs"
      contains: "func tqPrimaryButton"
    - path: "TimeQuest/App/TimeQuestApp.swift"
      provides: "Root injection of DesignTokens and dark mode default"
      contains: "preferredColorScheme(.dark)"
  key_links:
    - from: "TimeQuest/App/TimeQuestApp.swift"
      to: "TimeQuest/App/DesignSystem/DesignTokens.swift"
      via: ".environment(\\.designTokens, DesignTokens())"
      pattern: "\\.environment\\(\\.designTokens"
    - from: "TimeQuest/App/DesignSystem/ViewModifiers/CardModifier.swift"
      to: "TimeQuest/App/DesignSystem/DesignTokens.swift"
      via: "@Environment(\\.designTokens)"
      pattern: "@Environment\\(\\.designTokens\\)"
---

<objective>
Create the design system foundation: DesignTokens struct with semantic color, typography, spacing, and shape tokens; reusable ViewModifiers for cards, chips, and buttons; inject into the SwiftUI environment at the app root; set dark mode as default.

Purpose: This is the foundation every subsequent plan depends on. No view migration can happen until tokens and modifiers exist and are injected into the environment.
Output: DesignTokens.swift, CardModifier.swift, ChipModifier.swift, ButtonModifiers.swift, updated TimeQuestApp.swift, updated generate-xcodeproj.js with new files.
</objective>

<execution_context>
@/Users/davezabihaylo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davezabihaylo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-ui-brand-refresh/10-RESEARCH.md
@TimeQuest/App/TimeQuestApp.swift
@TimeQuest/App/AppDependencies.swift
@TimeQuest/Features/Player/Views/PlayerHomeView.swift
@TimeQuest/Features/Player/Views/SessionSummaryView.swift
@TimeQuest/Game/CelebrationScene.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DesignTokens struct with all semantic tokens and @Entry injection</name>
  <files>
    TimeQuest/App/DesignSystem/DesignTokens.swift
  </files>
  <action>
Create a single file `DesignTokens.swift` containing:

1. **DesignTokens class** -- `@Observable final class DesignTokens` with all tokens:

   **Colors (code-defined, no asset catalog needed):**
   - `surfacePrimary`: `Color(UIColor.systemBackground)` -- system dark/light background
   - `surfaceSecondary`: `Color(UIColor.secondarySystemGroupedBackground)` -- card background
   - `surfaceTertiary`: `Color(UIColor.tertiarySystemGroupedBackground)` -- nested card background
   - `accent`: `Color.teal` -- primary brand accent
   - `accentSecondary`: `Color.orange` -- achievement/celebration
   - `positive`: `Color.green` -- success states
   - `caution`: `Color.orange` -- warning/over-estimate
   - `negative`: `Color.red` -- error states
   - `discovery`: `Color.purple` -- way-off (non-judgmental)
   - `cool`: `Color.teal` -- under-estimate/calm
   - `school`: `Color.blue` -- school day context
   - `textPrimary`: `Color.primary`
   - `textSecondary`: `Color.secondary`
   - `textTertiary`: `Color(UIColor.tertiaryLabel)`

   **Typography function:**
   ```swift
   func font(_ style: Font.TextStyle, weight: Font.Weight = .regular) -> Font {
       .system(style, design: .rounded, weight: weight)
   }
   ```

   **Spacing constants:**
   - `spacingXS: CGFloat = 4`
   - `spacingSM: CGFloat = 8`
   - `spacingMD: CGFloat = 12`
   - `spacingLG: CGFloat = 16`
   - `spacingXL: CGFloat = 24`
   - `spacingXXL: CGFloat = 32`

   **Shape constants:**
   - `cornerRadiusSM: CGFloat = 8`
   - `cornerRadiusMD: CGFloat = 12`
   - `cornerRadiusLG: CGFloat = 16`
   - `cornerRadiusXL: CGFloat = 20`
   - `cornerRadiusFull: CGFloat = 100` (capsule)

   **Shadow (light mode only):**
   - `shadowColor = Color.black.opacity(0.12)`
   - `shadowRadius: CGFloat = 8`
   - `shadowY: CGFloat = 4`

   **SpriteKit color helpers:**
   ```swift
   var celebrationGolds: [SKColor] {
       [SKColor(Color.orange), SKColor(Color.yellow), SKColor(Color.orange.opacity(0.8)), SKColor.white]
   }
   var celebrationTeals: [SKColor] {
       [SKColor(Color.teal), SKColor(Color.cyan), SKColor.white]
   }
   var celebrationStreaks: [SKColor] {
       [SKColor(Color.orange), SKColor(red: 1.0, green: 0.35, blue: 0.1, alpha: 1.0), SKColor(Color.yellow)]
   }
   ```

2. **@Entry environment extension:**
   ```swift
   extension EnvironmentValues {
       @Entry var designTokens: DesignTokens = DesignTokens()
   }
   ```

Import both SwiftUI and SpriteKit. Use `import SpriteKit` for the SKColor helpers.

Note: Using UIColor.system* colors (wrapped in `Color()`) rather than custom asset catalog colors because they automatically adapt to dark/light mode and match the iOS system palette. This avoids creating a custom asset catalog and ensures the app feels native.
  </action>
  <verify>
File compiles -- run `node generate-xcodeproj.js && xcodebuild -project TimeQuest/TimeQuest.xcodeproj -scheme TimeQuest -destination 'platform=iOS Simulator,name=iPhone 16' build 2>&1 | tail -5` after Task 2 adds it to the project.
  </verify>
  <done>
DesignTokens.swift exists with all semantic color tokens, SF Rounded typography function, spacing/shape constants, SpriteKit color helpers, and @Entry environment injection.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ViewModifiers, inject tokens at app root, register files in project</name>
  <files>
    TimeQuest/App/DesignSystem/ViewModifiers/CardModifier.swift
    TimeQuest/App/DesignSystem/ViewModifiers/ChipModifier.swift
    TimeQuest/App/DesignSystem/ViewModifiers/ButtonModifiers.swift
    TimeQuest/App/TimeQuestApp.swift
    generate-xcodeproj.js
  </files>
  <action>
**CardModifier.swift:**
Create `TQCardModifier: ViewModifier` that:
- Reads `@Environment(\.designTokens)` and `@Environment(\.colorScheme)`
- Has `elevation` parameter: `.standard` (surfaceSecondary) or `.nested` (surfaceTertiary)
- Applies: `padding(tokens.spacingLG)`, background color based on elevation, `clipShape(RoundedRectangle(cornerRadius: tokens.cornerRadiusMD))`
- In dark mode: adds 1px white border at 6% opacity via `.overlay(RoundedRectangle(...).strokeBorder(...))`
- In light mode: adds shadow via `tokens.shadowColor`, `tokens.shadowRadius`, `tokens.shadowY`
- Add `View` extension: `func tqCard(elevation: TQCardModifier.CardElevation = .standard) -> some View`

**ChipModifier.swift:**
Create `TQChipModifier: ViewModifier` that:
- Reads `@Environment(\.designTokens)`
- Takes `color: Color` parameter
- Applies: `.font(.system(.caption, design: .rounded, weight: .medium))`, horizontal padding `tokens.spacingMD`, vertical padding `tokens.spacingSM - 2`, `background(color.opacity(0.15))`, `foregroundStyle(color)`, `clipShape(Capsule())`
- Add `View` extension: `func tqChip(color: Color) -> some View`

**ButtonModifiers.swift:**
Create `TQPrimaryButtonModifier: ViewModifier` that:
- Reads `@Environment(\.designTokens)`
- Applies: `tokens.font(.headline, weight: .semibold)`, `frame(maxWidth: .infinity)`, `padding(.vertical, 14)`, `background(tokens.accent)`, `foregroundStyle(.white)`, `clipShape(RoundedRectangle(cornerRadius: tokens.cornerRadiusMD))`
- Add `View` extension: `func tqPrimaryButton() -> some View`

**TimeQuestApp.swift:**
Update the `ContentView` body to inject design tokens and set dark mode:
- Add `.preferredColorScheme(.dark)` on the `RoleRouter()` (or on the Group)
- Add `.environment(\.designTokens, DesignTokens())` on the `RoleRouter()`
- Do NOT change the ModelContainer init or any other existing logic

**generate-xcodeproj.js:**
Add all 4 new files to the project file registration:
- `TimeQuest/App/DesignSystem/DesignTokens.swift`
- `TimeQuest/App/DesignSystem/ViewModifiers/CardModifier.swift`
- `TimeQuest/App/DesignSystem/ViewModifiers/ChipModifier.swift`
- `TimeQuest/App/DesignSystem/ViewModifiers/ButtonModifiers.swift`

Follow the existing pattern in generate-xcodeproj.js for adding files to the PBXFileReference, PBXBuildFile, PBXGroup, and PBXSourcesBuildPhase sections.

Then run `node generate-xcodeproj.js` to regenerate the project.

**Build verification:**
Run `xcodebuild -project TimeQuest/TimeQuest.xcodeproj -scheme TimeQuest -destination 'platform=iOS Simulator,name=iPhone 16' build 2>&1 | tail -20` to verify everything compiles.
  </action>
  <verify>
`xcodebuild build` succeeds with zero errors. `grep -r "designTokens" TimeQuest/App/TimeQuestApp.swift` finds the environment injection. `grep -r "preferredColorScheme" TimeQuest/App/TimeQuestApp.swift` finds the dark mode default.
  </verify>
  <done>
Three ViewModifier files exist (Card, Chip, Button). TimeQuestApp.swift injects DesignTokens into environment and sets dark mode default. All 4 new files registered in generate-xcodeproj.js. Project builds successfully.
  </done>
</task>

</tasks>

<verification>
1. `xcodebuild build` succeeds with zero errors
2. DesignTokens.swift contains @Entry environment extension
3. TimeQuestApp.swift has `.preferredColorScheme(.dark)` and `.environment(\.designTokens, ...)`
4. All 4 new Swift files are registered in generate-xcodeproj.js
5. `.tqCard()`, `.tqChip(color:)`, and `.tqPrimaryButton()` modifiers are available as View extensions
</verification>

<success_criteria>
- DesignTokens struct exists with semantic colors (surface, accent, text), SF Rounded typography, spacing, shapes, and SpriteKit helpers
- @Entry macro makes tokens accessible via @Environment(\.designTokens) in any view
- Three ViewModifier files provide .tqCard(), .tqChip(), .tqPrimaryButton()
- App root injects tokens and defaults to dark mode
- Project compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/10-ui-brand-refresh/10-01-SUMMARY.md`
</output>
