---
phase: 10-ui-brand-refresh
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - TimeQuest/Features/Player/Views/PlayerHomeView.swift
  - TimeQuest/Features/Player/Views/SessionSummaryView.swift
  - TimeQuest/Features/Player/Views/AccuracyRevealView.swift
  - TimeQuest/Features/Player/Views/PlayerStatsView.swift
  - TimeQuest/Features/Player/Views/PlayerRoutineCreationView.swift
  - TimeQuest/Features/Shared/Components/AccuracyMeter.swift
  - TimeQuest/Features/Shared/Components/XPBarView.swift
  - TimeQuest/Features/Shared/Components/InsightCardView.swift
  - TimeQuest/Features/Shared/Components/LevelBadgeView.swift
  - TimeQuest/Features/Shared/Components/StreakBadgeView.swift
autonomous: true

must_haves:
  truths:
    - "PlayerHomeView quest cards use .tqCard() instead of hardcoded background/cornerRadius"
    - "SessionSummaryView stat cards and result rows use design tokens for colors, fonts, and shapes"
    - "AccuracyRevealView feedback card uses .tqCard() and all typography uses tokens.font()"
    - "All .font(.headline), .font(.title3), etc. calls in these files are replaced with tokens.font()"
    - "All Color(.systemGray6) references replaced with tokens.surfaceSecondary or tokens.surfaceTertiary"
    - "All .teal, .orange, .purple inline colors replaced with tokens.accent, tokens.accentSecondary, tokens.discovery"
  artifacts:
    - path: "TimeQuest/Features/Player/Views/PlayerHomeView.swift"
      provides: "Token-migrated home screen with card-based quest list"
      contains: "@Environment(\\.designTokens)"
    - path: "TimeQuest/Features/Player/Views/SessionSummaryView.swift"
      provides: "Token-migrated session summary with consistent card styling"
      contains: "@Environment(\\.designTokens)"
    - path: "TimeQuest/Features/Player/Views/AccuracyRevealView.swift"
      provides: "Token-migrated accuracy reveal with consistent feedback card"
      contains: "@Environment(\\.designTokens)"
    - path: "TimeQuest/Features/Shared/Components/AccuracyMeter.swift"
      provides: "Token-migrated accuracy gauge"
      contains: "@Environment(\\.designTokens)"
  key_links:
    - from: "TimeQuest/Features/Player/Views/PlayerHomeView.swift"
      to: "TimeQuest/App/DesignSystem/DesignTokens.swift"
      via: "@Environment(\\.designTokens) private var tokens"
      pattern: "tokens\\.font\\(|tokens\\.accent|tqCard|tqChip"
    - from: "TimeQuest/Features/Player/Views/SessionSummaryView.swift"
      to: "TimeQuest/App/DesignSystem/DesignTokens.swift"
      via: "@Environment(\\.designTokens) private var tokens"
      pattern: "tokens\\.font\\(|tokens\\.surfaceSecondary|\\.tqCard"
---

<objective>
Migrate the 5 highest-priority player views and 5 shared components from hardcoded styles to design tokens and ViewModifiers.

Purpose: These are the most-seen screens in the app (home, quest results, stats) and the shared components they depend on. Migrating them establishes the new visual language across the primary player experience.
Output: 10 files updated to use design tokens consistently.
</objective>

<execution_context>
@/Users/davezabihaylo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davezabihaylo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-ui-brand-refresh/10-RESEARCH.md
@.planning/phases/10-ui-brand-refresh/10-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate shared components to design tokens</name>
  <files>
    TimeQuest/Features/Shared/Components/AccuracyMeter.swift
    TimeQuest/Features/Shared/Components/XPBarView.swift
    TimeQuest/Features/Shared/Components/InsightCardView.swift
    TimeQuest/Features/Shared/Components/LevelBadgeView.swift
    TimeQuest/Features/Shared/Components/StreakBadgeView.swift
  </files>
  <action>
For each of these 5 shared component files, apply the following migration pattern:

1. Add `@Environment(\.designTokens) private var tokens` to the view struct
2. Replace every `.font(.someStyle)` with `tokens.font(.someStyle)` and `.fontWeight(.bold)` with inline weight: `tokens.font(.someStyle, weight: .bold)`
3. Replace every `Color(.systemGray6)` or `Color(.systemGray3)` with the appropriate token:
   - Card backgrounds: `tokens.surfaceSecondary`
   - Nested backgrounds: `tokens.surfaceTertiary`
   - Inactive/track colors: `tokens.textTertiary.opacity(0.3)` or `tokens.surfaceTertiary`
4. Replace inline color names:
   - `.teal` -> `tokens.accent`
   - `.orange` -> `tokens.accentSecondary`
   - `.purple` -> `tokens.discovery`
   - `.green` -> `tokens.positive`
   - `.blue` -> `tokens.school`
5. Replace hardcoded `RoundedRectangle(cornerRadius: N)` with `RoundedRectangle(cornerRadius: tokens.cornerRadiusMD)` (or `tokens.cornerRadiusSM` for small elements)
6. Where a card pattern exists (padding + background + clipShape), replace with `.tqCard()` modifier if the component is self-contained. For components that are meant to be embedded (like XPBarView), just update the tokens without wrapping in `.tqCard()`.

**Specific per-file guidance:**

**AccuracyMeter.swift** (HIGH priority -- custom drawing):
- Replace hardcoded track color (likely gray) with `tokens.surfaceTertiary`
- Replace rating colors: `.teal` -> `tokens.accent`, `.orange` -> `tokens.accentSecondary`, `.purple` -> `tokens.discovery`, gray -> `tokens.textTertiary`
- Replace any `.font()` calls with `tokens.font()`

**XPBarView.swift:**
- Replace bar track color with `tokens.surfaceTertiary`
- Replace bar fill color (`.teal`) with `tokens.accent`
- Replace font calls with `tokens.font()`

**InsightCardView.swift:**
- Replace card background pattern with `.tqCard(elevation: .nested)` (these appear inside other containers)
- Replace all `.font()` and inline colors with tokens

**LevelBadgeView.swift:**
- Replace `.teal` accent with `tokens.accent`
- Replace font calls with `tokens.font()`

**StreakBadgeView.swift:**
- Replace `.orange` flame color with `tokens.accentSecondary`
- Replace font calls with `tokens.font()`

**CRITICAL: Do NOT change view structure, conditional logic, or animation triggers.** Only change styling values (fonts, colors, cornerRadius, backgrounds). This prevents breaking existing animations per Research pitfall #4.
  </action>
  <verify>
`xcodebuild -project TimeQuest/TimeQuest.xcodeproj -scheme TimeQuest -destination 'platform=iOS Simulator,name=iPhone 16' build 2>&1 | tail -5` shows BUILD SUCCEEDED. `grep -r "Color(.systemGray" TimeQuest/Features/Shared/Components/` returns zero matches. `grep -r "\.font(\." TimeQuest/Features/Shared/Components/ | grep -v "tokens.font"` returns zero matches (excluding any .font(.system(.caption, design: .rounded)) inside ChipModifier itself which is in a different directory).
  </verify>
  <done>
All 5 shared components use design tokens for colors, typography, and shapes. No hardcoded Color(.systemGray*), no bare .font(.headline), no inline .teal/.orange/.purple remain in these files.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate 5 high-priority player views to design tokens</name>
  <files>
    TimeQuest/Features/Player/Views/PlayerHomeView.swift
    TimeQuest/Features/Player/Views/SessionSummaryView.swift
    TimeQuest/Features/Player/Views/AccuracyRevealView.swift
    TimeQuest/Features/Player/Views/PlayerStatsView.swift
    TimeQuest/Features/Player/Views/PlayerRoutineCreationView.swift
  </files>
  <action>
For each of these 5 player view files, apply the same migration pattern as Task 1:

1. Add `@Environment(\.designTokens) private var tokens` to the view struct
2. Replace all `.font()` calls with `tokens.font()` equivalents
3. Replace all `Color(.systemGray6)` with `tokens.surfaceSecondary` or `.tqCard()` where appropriate
4. Replace all inline semantic colors with token references
5. Replace all hardcoded cornerRadius values with token constants

**Specific per-file guidance:**

**PlayerHomeView.swift** (16 font calls, 5 hardcoded colors, 2 card backgrounds):
- `questCard()` function: Replace the `padding(16) + background(Color(.systemGray6)) + clipShape(RoundedRectangle(cornerRadius: 12))` pattern with `.tqCard()`. Note: the HStack content inside still needs its own styling, so apply `.tqCard()` AFTER the HStack, replacing the 3-line pattern.
- `createQuestButton`: Same `.tqCard()` migration
- "Calibrating" chip: Replace manual capsule styling with `.tqChip(color: tokens.accentSecondary)`
- `calendarContextChip`: Replace manual capsule styling:
  - School day: `.tqChip(color: tokens.school)`
  - Free day: `.tqChip(color: tokens.accentSecondary)`
- Logo area: `tokens.font(.largeTitle, weight: .bold)` for "TimeQuest"
- All `.font(.caption)`, `.font(.title3)`, `.font(.headline)` etc. -> `tokens.font()`
- `.foregroundStyle(.teal)` -> `tokens.accent`
- `.foregroundStyle(.orange)` -> `tokens.accentSecondary`
- Star icon `.foregroundStyle(.orange)` -> `tokens.accentSecondary`
- Set app background: Add `.background(tokens.surfacePrimary)` to the outermost container if not already using system background

**SessionSummaryView.swift** (18 font calls, 7 hardcoded colors, 4 card backgrounds):
- `statCard()` function: Replace background/clipShape pattern with `.tqCard(elevation: .nested)`
- `taskResultRow()` function: Replace background/clipShape pattern with `.tqCard(elevation: .nested)`. Use `tokens.cornerRadiusMD` instead of `cornerRadius: 10`.
- Calibration message card: Replace with `.tqCard()`
- XP card: Replace with `.tqCard()`
- `ratingColor()` function: `.orange` -> `tokens.accentSecondary`, `.teal` -> `tokens.accent`, `Color(.systemGray3)` -> `tokens.textTertiary`, `.purple` -> `tokens.discovery`
- Difference colors: `Color.orange.opacity(0.8)` -> `tokens.caution.opacity(0.8)`, `Color.teal.opacity(0.8)` -> `tokens.cool.opacity(0.8)`
- All `.font()` -> `tokens.font()`
- "+N XP" text: `.foregroundStyle(.teal)` -> `tokens.accent`
- "Level Up!" text: `.foregroundStyle(.orange)` -> `tokens.accentSecondary`

**AccuracyRevealView.swift** (10 font calls, 3 hardcoded colors, 1 card background):
- `feedbackCard()`: Replace `padding(20) + background(Color(.systemGray6)) + clipShape(RoundedRectangle(cornerRadius: 16))` with `.tqCard()`
- `differenceView()`: `Color.orange.opacity(0.8)` -> `tokens.caution.opacity(0.8)`, `Color.teal.opacity(0.8)` -> `tokens.cool.opacity(0.8)`
- `.font(.system(.title, design: .rounded))` already uses .rounded -- replace with `tokens.font(.title, weight: .bold)` for consistency
- All other `.font()` -> `tokens.font()`
- **CRITICAL: Do NOT modify the .onAppear block with DispatchQueue.main.asyncAfter or withAnimation calls.** Leave animation timing exactly as-is.

**PlayerStatsView.swift** (10 font calls, 4 hardcoded colors, 4 card backgrounds):
- Replace all card background patterns with `.tqCard()` or `.tqCard(elevation: .nested)` based on nesting
- Replace all `.font()` -> `tokens.font()`
- Replace semantic colors with tokens

**PlayerRoutineCreationView.swift** (26 font calls, 6 hardcoded colors, 5 card backgrounds):
- This is the largest view. Replace all font/color/background patterns systematically.
- Card backgrounds -> `.tqCard()` where appropriate
- Form sections may use `.listRowBackground(tokens.surfaceSecondary)` instead of `.tqCard()`
- All `.font()` -> `tokens.font()`
- All inline colors -> token references

**CRITICAL RULE: Only change styling. Do NOT restructure view hierarchies, change conditional logic, modify @State variables, or alter animation blocks.** This is a cosmetic migration only.

After all 5 files are migrated, run the build to verify compilation.
  </action>
  <verify>
`xcodebuild -project TimeQuest/TimeQuest.xcodeproj -scheme TimeQuest -destination 'platform=iOS Simulator,name=iPhone 16' build 2>&1 | tail -5` shows BUILD SUCCEEDED. `grep -rn "Color(.systemGray" TimeQuest/Features/Player/Views/PlayerHomeView.swift TimeQuest/Features/Player/Views/SessionSummaryView.swift TimeQuest/Features/Player/Views/AccuracyRevealView.swift TimeQuest/Features/Player/Views/PlayerStatsView.swift TimeQuest/Features/Player/Views/PlayerRoutineCreationView.swift` returns zero matches.
  </verify>
  <done>
All 5 high-priority player views use design tokens consistently. No hardcoded Color(.systemGray*), no bare .font(.someStyle), no inline .teal/.orange/.purple remain in these files. All card patterns use .tqCard() modifier. Project compiles cleanly.
  </done>
</task>

</tasks>

<verification>
1. `xcodebuild build` succeeds with zero errors
2. Zero `Color(.systemGray` references remain in the 10 migrated files
3. Zero bare `.font(.headline)` (etc.) calls remain in migrated files -- all use `tokens.font()`
4. Zero inline `.teal`, `.orange`, `.purple` color references remain in migrated files
5. All card backgrounds use `.tqCard()` or `.tqCard(elevation: .nested)`
6. Existing animations and view logic are unchanged
</verification>

<success_criteria>
- 5 shared components + 5 player views fully migrated to design tokens
- Consistent SF Rounded typography across all migrated views
- Consistent card styling with dark-mode-aware borders/shadows
- Semantic color usage replaces all hardcoded color names
- Project compiles with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-ui-brand-refresh/10-02-SUMMARY.md`
</output>
